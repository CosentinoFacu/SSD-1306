'''
Programa: test ssd mpu

Proposito: Verificar el correcto complemento
de interfaz visual que nos da la pantalla OLED
y mostrar los valores obtenidos de MPU6050

Programadores: Facundo Cosentino, Sergio Zelaya
Fecha: 23/08/2022
'''

#Importamos MPU_6050 de imu
from imu import MPU6050        
#Importamos time para los delay
import time                    
#Importamos Pin e I2C de machine
from machine import Pin, I2C  
#Importamos ssd1306
import ssd1306
#Importamos framebuf
import framebuf

#Cargamos logo de UTN
logo = [0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0x83, 0xf0, 0x7c, 0x0f, 0xc0,
        0x3f, 0xf8, 0x03, 0xc0, 0x00, 0x00, 0x03,
        0xc0, 0x1f, 0xfc, 0x03, 0x81, 0xf0, 0x7c,
        0x0f, 0x80, 0x1f, 0xf8, 0x03, 0xc0, 0x00,
        0x00, 0x03, 0xc0, 0x0f, 0xfc, 0x01, 0x81,
        0xf0, 0x7c, 0x1f, 0x80, 0x1f, 0xf8, 0x03,
        0xc0, 0x00, 0x00, 0x03, 0xc0, 0x0f, 0xfc,
        0x01, 0xc1, 0xf0, 0x7c, 0x1f, 0x80, 0x1f,
        0xf8, 0x03, 0xc0, 0x00, 0x00, 0x03, 0xc0,
        0x07, 0xfc, 0x01, 0xc0, 0xf0, 0x78, 0x1f,
        0x80, 0x1f, 0xf8, 0x03, 0xc0, 0x00, 0x00,
        0x03, 0xc0, 0x03, 0xfc, 0x01, 0xc0, 0x70,
        0x70, 0x3f, 0x80, 0x1f, 0xf8, 0x03, 0xc0,
        0x00, 0x00, 0x03, 0xc0, 0x03, 0xfc, 0x01,
        0xe0, 0x30, 0x60, 0x3f, 0x80, 0x1f, 0xf8,
        0x03, 0xc0, 0x00, 0x00, 0x03, 0xc0, 0x01,
        0xfc, 0x01, 0xf0, 0x00, 0x00, 0x7f, 0x80,
        0x1f, 0xf8, 0x03, 0xff, 0xe0, 0x07, 0xff,
        0xc0, 0x00, 0xfc, 0x01, 0xf8, 0x00, 0x00,
        0xff, 0x80, 0x1f, 0xf8, 0x03, 0xff, 0xe0,
        0x0f, 0xff, 0xc0, 0x00, 0x7c, 0x01, 0xfc,
        0x00, 0x01, 0xff, 0x80, 0x1f, 0xf8, 0x03,
        0xff, 0xe0, 0x0f, 0xff, 0xc0, 0x00, 0x7c,
        0x01, 0xfe, 0x00, 0x03, 0xff, 0x80, 0x1f,
        0xf8, 0x03, 0xff, 0xe0, 0x0f, 0xff, 0xc0,
        0x00, 0x3c, 0x01, 0xff, 0x80, 0x0f, 0xff,
        0x80, 0x1f, 0xf8, 0x03, 0xff, 0xe0, 0x0f,
        0xff, 0xc0, 0x00, 0x3c, 0x01, 0x80, 0x00,
        0x00, 0x1f, 0x80, 0x1f, 0xf8, 0x03, 0xff,
        0xe0, 0x0f, 0xff, 0xc0, 0x00, 0x1c, 0x01,
        0x80, 0x00, 0x00, 0x0f, 0x80, 0x1f, 0xf8,
        0x03, 0xff, 0xe0, 0x0f, 0xff, 0xc0, 0x00,
        0x0c, 0x01, 0x80, 0x00, 0x00, 0x0f, 0x80,
        0x1f, 0xf8, 0x03, 0xff, 0xe0, 0x0f, 0xff,
        0xc0, 0x00, 0x04, 0x01, 0x80, 0x00, 0x00,
        0x0f, 0x80, 0x1f, 0xf8, 0x03, 0xff, 0xe0,
        0x0f, 0xff, 0xc0, 0x10, 0x04, 0x01, 0x80,
        0x00, 0x00, 0x0f, 0x80, 0x1f, 0xf8, 0x03,
        0xff, 0xe0, 0x0f, 0xff, 0xc0, 0x18, 0x00,
        0x01, 0xff, 0x00, 0x0f, 0xff, 0x80, 0x1f,
        0xf8, 0x03, 0xff, 0xe0, 0x0f, 0xff, 0xc0,
        0x1c, 0x00, 0x01, 0xfe, 0x00, 0x07, 0xff,
        0xc0, 0x1f, 0xf8, 0x03, 0xff, 0xe0, 0x0f,
        0xff, 0xc0, 0x1c, 0x00, 0x01, 0xfc, 0x00,
        0x01, 0xff, 0xc0, 0x1f, 0xf8, 0x03, 0xff,
        0xe0, 0x0f, 0xff, 0xc0, 0x1e, 0x00, 0x01,
        0xf8, 0x00, 0x00, 0xff, 0xc0, 0x1f, 0xf0,
        0x03, 0xff, 0xe0, 0x0f, 0xff, 0xc0, 0x1f,
        0x00, 0x01, 0xf0, 0x00, 0x00, 0x7f, 0xc0,
        0x0f, 0xf0, 0x07, 0xff, 0xe0, 0x0f, 0xff,
        0xc0, 0x1f, 0x00, 0x01, 0xe0, 0x00, 0x00,
        0x7f, 0xc0, 0x07, 0xe0, 0x07, 0xff, 0xe0,
        0x0f, 0xff, 0xc0, 0x1f, 0x80, 0x01, 0xe0,
        0x70, 0x70, 0x3f, 0xe0, 0x00, 0x00, 0x07,
        0xff, 0xe0, 0x0f, 0xff, 0xc0, 0x1f, 0xc0,
        0x01, 0xc0, 0xf0, 0x78, 0x1f, 0xe0, 0x00,
        0x00, 0x0f, 0xff, 0xe0, 0x0f, 0xff, 0xc0,
        0x1f, 0xc0, 0x01, 0xc1, 0xf0, 0x78, 0x1f,
        0xf0, 0x00, 0x00, 0x0f, 0xff, 0xe0, 0x0f,
        0xff, 0xc0, 0x1f, 0xe0, 0x01, 0x81, 0xf0,
        0x7c, 0x1f, 0xf8, 0x00, 0x00, 0x1f, 0xff,
        0xe0, 0x0f, 0xff, 0xc0, 0x1f, 0xf0, 0x01,
        0x81, 0xf0, 0x7c, 0x1f, 0xfc, 0x00, 0x00,
        0x3f, 0xff, 0xe0, 0x0f, 0xff, 0xc0, 0x1f,
        0xf0, 0x01, 0x83, 0xf0, 0x7c, 0x0f, 0xfe,
        0x00, 0x00, 0xff, 0xff, 0xe0, 0x0f, 0xff,
        0xc0, 0x1f, 0xf8, 0x01, 0xc3, 0xf0, 0x7e,
        0x1f, 0xff, 0xc0, 0x03, 0xff, 0xff, 0xf0,
        0x0f, 0xff, 0xc0, 0x3f, 0xfc, 0x03, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff]


#Configuramos comunicacion I2C 
I2c = I2C(0,sda=Pin(21),scl=Pin(22),freq=400000)
#Configuramos MPU6050
imu = MPU6050(I2c)
#Configuramos pantalla ssd1306
display = ssd1306.SSD1306_I2C(128, 32, I2c)


#Mostramos logo
bf = bytearray(logo)
fb = framebuf.FrameBuffer(bf,128,32,framebuf.MONO_HLSB)
display.fill(0)
display.blit(fb,0,0)
display.show()   
time.sleep(3)

#Mostramos Titulo
display.fill(0)
display.text('VER VALORES', 0, 0, 1)
display.text('DE LOS 3 EJES', 0, 10, 1)
display.text('X Y Z', 0, 20, 1)
display.show()   
time.sleep(3)

while True:
    # Leemos Aceleracion en X
    Gx = imu.accel.x - 0.06112061   
    # Leemos Aceleracion en Y
    Gy = imu.accel.y + 0.03150146   
    # Leemos Aceleracion en Z
    Gz = imu.accel.z + 0.07965576
    
    #Mostramos mensaje
    display.fill(0)
    display.text('X:', 0, 0, 1)
    display.text('Y:', 50, 0, 1)
    display.text('Z:', 90, 0, 1)
    display.text(str(round(Gx,1)), 0, 20, 1)
    display.text(str(round(Gy,1)), 50, 20, 1)
    display.text(str(round(Gz,1)), 90, 20, 1)
    display.show()    

    time.sleep(0.05)      #Esperamos un 1 segundo
